<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="%PUBLIC_URL%/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>React App</title>
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=71bc6dc9e23e2fddadaa922419145b18"></script>
  </head>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root"></div>
    <div class="defaults"></div>
    <div class="mask">Loading...</div>

    <style>
      .defaults{
        position: absolute;
        top: -99999999px;
      }
      .mask{
        width: 100%;
        height: 100vh;
        background-color: #111;
        position: fixed;
        top: 0;
        left: 0;
        z-index: 100;
        opacity: 1;
        transition: opacity 2s;
        display: flex;
        justify-content: center;
        align-items: center;
      }
      .mask.off{
        opacity: 0;
      }
    </style>
    <script>
      const defaults = document.querySelector('.defaults');
      const mask = document.querySelector('.mask');
      let tags = '';
      const baseUrl = 'https://leeyujoo.com/layout_practice/img/';
      const imgs = [
        baseUrl+'Community.jpg',
        baseUrl+'Department.jpg',
        baseUrl+'Gallery.jpg',
        baseUrl+'Location.jpg',
        baseUrl+'Member.jpg',
        baseUrl+'Youtube.jpg',
      ]
      const vids= [
        baseUrl+'vid1.mp4',
      ]

      createDOM();
      endLoading();
      
      function createDOM() {
        imgs.forEach(src=>tags+=`<img src=${src} />`);
        vids.forEach(src=>tags+=`<video src=${src}></video>`);
        defaults.innerHTML = tags;
      }
      function loadImg() {
        return new Promise((res,rej)=>{
          let countImg = 0;
          const imgDOM = defaults.querySelectorAll('img');

          imgDOM.forEach(img=>{
            img.onload = ()=>{
              countImg++;
              if (countImg === imgs.length) res(true);
            }
          })
        })
      }
      function loadVid() {
        return new Promise((res,rej)=>{
          let countVid = 0;
          const vidDOM = defaults.querySelectorAll('video');

          vidDOM.forEach(vid=>{
            vid.onloadeddata = ()=>{
              countVid++;
              if (countVid === vids.length) res(true);
            }
          })
        })
      }
      async function endLoading() {
        const result = await Promise.all([loadImg(), loadVid()])
        const [loadedImg, loadedVid] = result;

        if (loadedImg && loadedVid) {
          mask.classList.add('off');
        }

        setTimeout(()=>{
          mask.remove();
          defaults.remove();
        }, 2000);
      }
    </script>
  </body>
</html>

<!-- 
  SSR : server side rendering
    페이지 이동 시 일일이 HTML 파일을 서버로부터 불러오는 방식 
  - 초기 로딩 속도가 빠르다.
  - SEO 최적화에 유리하다.

  CSR : client side rendering
    초기 페이지 로딩 시 모든 컴포넌트(JSX) 파일을 한번에 불러오는 방식
  - 한번 데이터를 가져온 이후 페이지 이동 시 전환 로딩이 없다.
  - 초기 로딩 속도가 상대적으로 길다.
  - SEO 최적화에 취약하다.
 -->